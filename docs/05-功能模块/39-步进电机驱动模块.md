

### **ULN2003 步进电机驱动模块 Arduino 介绍资料**

#### **1. 概述**

ULN2003 步进电机驱动模块（也常被称为“ULN2003 驱动板”或“28BYJ-48电机驱动板”）是一款非常常见且经济的驱动解决方案，专为驱动**小型五线四相（或六线四相）步进电机**而设计，其中最经典的搭配是 **28BYJ-48** 步进电机。

其核心是一颗 **ULN2003AN** 达林顿晶体管阵列芯片。该芯片内部包含7个NPN达林顿管，每个都能提供最高500mA的驱动电流，并内置续流二极管，用于驱动感性负载（如继电器、电机线圈）。模块上通常有4个LED，用于直观显示电机的各相工作状态。

![ULN2003 Module](https://i.imgur.com/3zGcWQp.png) *(注：此处为示例图片链接，展示了模块与28BYJ-48电机的典型组合)*

#### **2. 特点**

*   **高驱动能力**：ULN2003 单路最大输出电流达 500mA，最大输出电压可达 50V。
*   **内置保护**：芯片内部集成了续流二极管，用于吸收电机线圈在断电时产生的反向感应电动势，保护 Arduino 主板免受高压冲击。
*   **直观指示**：模块自带4个LED，分别对应4个输出通道，可以清晰地显示电机各相的工作状态，便于调试。
*   **接口方便**：采用标准的4相电机接口和杜邦针排针，与主控板和电机连接都非常简便。
*   **成本极低**：是目前市面上性价比最高的步进电机驱动方案之一。
*   **易于控制**：采用简单的脉冲序列控制，无需复杂的指令。

#### **3. 技术参数**

| 参数 | 值/描述 |
| :--- | :--- |
| **供电电压 (VCC)** | **5V ~ 12V** （建议使用外部电源，而非Arduino的5V引脚） |
| **输入电压 (逻辑电平)** | 3.3V - 5V （与 Arduino I/O 口完全兼容） |
| **每路驱动电流** | 最大 **500 mA** |
| **最大输出电压** | 50 V |
| **控制信号** | 4 相脉冲 (IN1, IN2, IN3, IN4) |
| **驱动方式** | 4 相 8 拍 / 4 相 4 拍 （双四拍） |
| **适配电机** | 5V 或 12V 四相五线 / 四相六线步进电机（如 28BYJ-48） |

#### **4. 引脚定义与接线说明**

**模块引脚定义**：
*   **IN1 ~ IN4**： 控制信号输入引脚，连接 Arduino 的数字输出引脚。
*   **GND**： 模块和外部电源的共地线。**必须与 Arduino GND 相连**。
*   **VCC**： **电机电源**正极（接**外部** 5V-12V 电源）。**切勿接 Arduino 5V 引脚**，以免电流不足导致板卡复位。
*   **Motor Port**： 4引脚插座，用于连接步进电机（如28BYJ-48）。

**Arduino 接线示意图**：
*(以驱动28BYJ-48 5V步进电机为例)*

| ULN2003 模块引脚 | 连接目标 |
| :--------------- | :--------------- |
| **IN1** | Arduino **数字引脚 8** |
| **IN2** | Arduino **数字引脚 9** |
| **IN3** | Arduino **数字引脚 10** |
| **IN4** | Arduino **数字引脚 11** |
| **GND** | Arduino **GND** （**以及外部电源的GND**） |
| **VCC** | **外部 5V 电源** 的正极 (如 5V 适配器或电池盒) |

**重要提示**：
*   **必须使用外部电源**：电机的功耗远大于 Arduino 板载稳压器所能提供的功率。务必使用独立电源为模块的 VCC 和 GND 供电，并将此外部电源的 GND 与 Arduino 的 GND 连接起来（共地）。
*   **电机连接**：将 28BYJ-48 电机的导线插头直接插入模块的电机端口即可。

#### **5. 控制逻辑与示例程序 (使用 Arduino Stepper库)**

控制步进电机需要按特定顺序循环给 IN1~IN4 引脚通电。最常用的控制序列是 **8拍**（半步）和 **4拍**（整步）模式。8拍模式精度更高，但扭矩稍小；4拍模式扭矩更大，但精度减半。

**示例程序 1：使用 Arduino 内置的 Stepper 库**

这是最简单的方法，但灵活性较低。

```cpp
#include <Stepper.h>

// 定义电机步进数及接线引脚
// 28BYJ-48电机的步进角为5.625°，转一圈需要 360°/5.625° = 64步。
// 但内部有1/64的减速箱，所以实际输出轴转一圈需要 64 * 64 = 4096 步。
const int stepsPerRevolution = 4096; 

// 初始化步进电机对象，指定步数和引脚
Stepper myStepper(stepsPerRevolution, 8, 10, 9, 11); // 顺序为 IN1, IN3, IN2, IN4

void setup() {
  // 设置电机转速（单位：RPM 每分钟转数）
  myStepper.setSpeed(10); // 设为每分钟10转
}

void loop() {
  // 顺时针转一圈
  myStepper.step(stepsPerRevolution);
  delay(500);

  // 逆时针转一圈
  myStepper.step(-stepsPerRevolution);
  delay(500);
}
```

**示例程序 2：手动控制序列（更常用、更灵活）**

这种方法可以完全控制速度和模式，是更推荐的方式。

```cpp
// 定义控制引脚
#define IN1 8
#define IN2 9
#define IN3 10
#define IN4 11

// 8拍步进序列（半步进）：A-AB-B-BC-C-CD-D-DA
// 这是一个8步的数组，定义了IN1~IN4的激活顺序
int step8[8][4] = {
  {1, 0, 0, 0}, // 步 1: A相
  {1, 1, 0, 0}, // 步 2: A相和B相
  {0, 1, 0, 0}, // 步 3: B相
  {0, 1, 1, 0}, // 步 4: B相和C相
  {0, 0, 1, 0}, // 步 5: C相
  {0, 0, 1, 1}, // 步 6: C相和D相
  {0, 0, 0, 1}, // 步 7: D相
  {1, 0, 0, 1}  // 步 8: D相和A相
};

void setup() {
  // 将所有控制引脚设置为输出模式
  pinMode(IN1, OUTPUT);
  pinMode(IN2, OUTPUT);
  pinMode(IN3, OUTPUT);
  pinMode(IN4, OUTPUT);
}

void loop() {
  // 顺时针旋转（正向序列）
  for (int i = 0; i < 512; i++) { // 循环512次（约1/8圈）
    for (int j = 0; j < 8; j++) { // 循环执行8拍序列
      digitalWrite(IN1, step8[j][0]);
      digitalWrite(IN2, step8[j][1]);
      digitalWrite(IN3, step8[j][2]);
      digitalWrite(IN4, step8[j][3]);
      delay(3); // 通过调整这个延时来控制速度，值越小越快
    }
  }
  delay(1000); // 停1秒

  // 逆时针旋转（反向序列）
  for (int i = 0; i < 512; i++) {
    for (int j = 7; j >= 0; j--) { // 反向执行8拍序列
      digitalWrite(IN1, step8[j][0]);
      digitalWrite(IN2, step8[j][1]);
      digitalWrite(IN3, step8[j][2]);
      digitalWrite(IN4, step8[j][3]);
      delay(3);
    }
  }
  delay(1000);
}
```

#### **6. 库文件地址**

**方法一：使用内置库**
Arduino IDE 自带了 `Stepper.h` 库，无需额外安装。可通过 **「项目」->「加载库」->「管理库...」** 查看。

**方法二：使用更强大的第三方库 (AccelStepper)**
对于更复杂的应用（如加速度控制、多电机控制），强烈推荐功能更强大的 `AccelStepper` 库。

*   **GitHub 仓库地址**：
    [https://github.com/waspinator/AccelStepper](https://github.com/waspinator/AccelStepper)
*   **安装方法**：
    在 Arduino IDE 的库管理器中搜索 "**AccelStepper**"，然后选择由 Mike McCauley 开发的库进行安装。

---

**使用提示与注意事项**：
*   **发热**：ULN2003 芯片在工作时会有明显发热，这是正常现象。
*   **堵转**：步进电机堵转（轴被卡住）时不会损坏，但线圈会持续通电，导致驱动芯片急剧发热。应及时断电。
*   **电源匹配**：务必根据电机的额定电压（如 5V 或 12V）来选择外部电源。
*   **步骤校准**：28BYJ-48 电机的实际步数可能因制造商而异，4096是常见值，可能需要根据实际情况微调。